"use strict";(self.webpackChunkContainer_assets=self.webpackChunkContainer_assets||[]).push([[89],{9465:(e,t,n)=>{n.d(t,{Z:()=>s});var l=n(8081),a=n.n(l),o=n(3645),i=n.n(o)()(a());i.push([e.id,".title .drop {\n  cursor: pointer;\n  width: 520px;\n  border-radius: 2px;\n  border-color: #eeeeee;\n  border-style: dashed;\n  color: #bdbdbd;\n  outline: none;\n  margin: auto;\n}\n.title .uploadBac {\n  position: relative;\n  padding-top: 20px;\n  padding-bottom: 20px;\n  background-color: #fafafc;\n}\n.title .uploadBac p {\n  text-align: center;\n  font-size: 20px;\n  margin-bottom: 0px !important;\n}\n\n.uploadBac .icon svg {\n  width: 35px;\n  height: 35px;\n}\n.fileTable .ant-table-tbody > tr > td {\n  max-width: 300px;\n}\n.showTable {\n  width: 100%;\n  position: relative;\n}\n.showTable .ant-spin-container {\n  transition: all 2s ease;\n}\n.action_bac {\n  width: 100%;\n  height: 32px;\n  bottom: 15px;\n  position: absolute;\n}\n.showTable .ant-pagination-prev,\n.showTable .ant-pagination-next,\n.showTable .ant-pagination-item {\n  z-index: 1;\n}\n.Action {\n  position: absolute;\n  right: 200px;\n}\n",""]);const s=i},8089:(e,t,n)=>{n.r(t),n.d(t,{default:()=>U,getReverseFileExtension:()=>C});var l=n(7294),a=n(463),o=n(2023),i=n(7183),s=n(8361),r=n(331),c=n(4078),u=n(1577),g=n(1813),p=n(2484),d=n(5689),m=n(9704),f=n(3379),h=n.n(f),y=n(7795),k=n.n(y),b=n(569),v=n.n(b),w=n(3565),x=n.n(w),E=n(9216),Z=n.n(E),I=n(4589),S=n.n(I),N=n(9465),_={};_.styleTagTransform=S(),_.setAttributes=x(),_.insert=v().bind(null,"head"),_.domAPI=k(),_.insertStyleElement=Z();h()(N.Z,_);N.Z&&N.Z.locals&&N.Z.locals;const{Content:A}=i.Z,C=e=>{switch(Object.keys(e)[0]){case"jpeg":return"image/jpeg";case"gif":return"image/gif";case"jpg":return"image/jpg";case"png":return"image/png";case"svg":return"image/svg";case"avi":return"video/avi";case"mp4":return"video/mp4";case"aac":return"video/aac";case"wav":return"audio/wav";case"mp3":return"audio/mp3";case"wasm":return"application/wasm";default:return""}},T=e=>{switch(e){case"image/jpeg":return{jpeg:null};case"image/gif":return{gif:null};case"image/jpg":return{jpg:null};case"image/png":return{png:null};case"image/svg":return{svg:null};case"video/avi":return{avi:null};case"video/aac":return{aac:null};case"video/mp4":return{mp4:null};case"audio/wav":return{wav:null};case"audio/mp3":case"audio/mpeg":return{mp3:null};case"application/wasm":return{wasm:null};default:return null}};let P="",j=[],F="",O=!1,R=0,z=!0,B=[];const J=[];const U=function(){const[e,t]=(0,l.useState)(""),{principal:n,assets:i,bucketActor:f}=(0,m.v9)((e=>e)),h=n.value;let y=JSON.parse(localStorage.getItem(h));const k=null===y?[]:y,b=null===i?[]:i.ok;if(k.length<b.length&&z)for(let e=0;e<b.length;e++)k[e]={filekey:b[e].file_key,bucketId:b[e].bucket_id.toString(),filename:b[e].file_name,filetype:[Object.keys(b[e].file_extension)[0]],id:b[e].file_key};function v(e){let t=0;return e.forEach((n=>{n.then((n=>{t++,console.log(n),t===Math.floor(e.length/2)&&location.reload()}))})),Promise.all(e)}const w=(0,l.useCallback)((e=>{let n=[];R=e.length,console.log(e);let l=0;for(let a=0;a<e.length;a++){const i=e[a];let r="";const c=[],u=[],g=[];let p=i.size;l+=p,console.log("fileSize:",p);let d=1992295,m=Math.ceil(p/d);console.log("chunks:",m);let h=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,y=0;const b=[],w=new FileReader;let x=T(i.type);w.onload=function(e){console.log("333");let l=e.target.result,a=new Uint8Array(l),p=[];for(let e=0;e<a.length;e++)p.push(a[e]);let d=o.sha256.digest(p);if(g.push(d),u.push(p),c.push(...d),y++,y<m)E();else{if(r=(0,o.sha256)(c),r=r.toUpperCase(),k.find((e=>e.filekey===r)))R--,s.ZP.error(`${r} is Repeat`);else{O=!0,t({}),console.log("ok");for(let e=0;e<u.length;e++)console.log(r),b.push(f.put({file_key:r,file_name:i.name,file_extension:x,chunk:{digest:g[e],data:u[e]},chunk_number:m,order:e}));n.push(...b),0===n.length&&v(n).then((e=>{console.log(e)}))}}};const E=()=>{console.log("222222");let e=y*d,t=e+d>p?p:e+d;w.readAsArrayBuffer(h.call(i,e,t))};E()}}),[k,f]);if(O){let e=JSON.parse(localStorage.getItem(h));setInterval((x=(null===e?[]:e).length,async()=>{console.log("in---------",R);let e=await f.getAssetExts();console.log(e.ok.length,x),e.ok.length===x+R&&(console.log("上传完成"),console.log(e.ok),location.reload(!0))}),1e3)}var x;(0,l.useEffect)((()=>()=>{Promise.all(J).then((()=>{console.log("deleted")}))}));const E=e=>async()=>{(async e=>{console.log(e);let t=await f.getAssetExtkey(e);console.log("RE",t);let n=Number(t.ok.need_query_times);console.log(n);let l=[];for(let t=0;t<n;t++){let n=await f.get({file_key:e,flag:t});console.log(t),console.log(n);let a=n.ok[0];for(let e=1;e<n.ok.length;e++)a=a.concat(n.ok[e]);l=l.concat(a)}console.log(l);let a=new Uint8Array(l).buffer;console.log(a);let o=C(t.ok.file_extension);const i=new Blob([a],{type:o});return console.log(i),URL.createObjectURL(i)})(e).then((e=>{e&&window.open(`${e}`)}))},Z={onChange:(e,t)=>{B=t}},I=[{title:"FileName",dataIndex:"filename"},{title:"BucketId",dataIndex:"bucketId"},{title:"FileKey",dataIndex:"filekey"},{title:"FileType",dataIndex:"filetype",render:e=>l.createElement("span",null,e.map((e=>{let t;switch(e){case"mp3":case"wav":t="volcano";break;case"acc":case"mp4":case"avi":t="geekblue";break;default:t="magenta"}return l.createElement(r.Z,{color:t,key:Date.now()},e)})))},{title:"Action",key:"action",render:(e,t)=>l.createElement(c.Z,{size:"middle"},l.createElement(u.Z,{type:"primary",onClick:E(t.filekey)},"Entry"))}],S=[];""!==P&&S.push({id:P,filename:"",bucketId:"",filekey:P,filetype:[""]}),P="",j=k.length>0?[...k,...S]:S,F=JSON.stringify(j),j.length>0&&""!==h&&localStorage.setItem(h,F);const{getRootProps:N,getInputProps:_}=(0,a.uI)({onDrop:w});return l.createElement(A,{style:{padding:"0 0",minHeight:0},className:"main"},l.createElement("div",{className:"showTable"},l.createElement("div",{className:"title"},l.createElement("div",null,l.createElement("div",{className:"drop",...N()},l.createElement("input",{..._()}),l.createElement("div",{className:"uploadBac"},l.createElement("p",null,l.createElement(d.Z,{className:"icon"})),l.createElement("p",null,"Click one or drag many files to this area to upload"))))),l.createElement(g.Z,{className:"fileTable",rowSelection:Z,rowKey:e=>e.id,columns:I,pagination:{position:"bottomRight"},dataSource:j}),l.createElement("div",{className:"action_bac"},l.createElement(c.Z,{style:{display:j.length>0?"inline-flex":"none"},size:"middle",className:"Action"},l.createElement(p.Z,{title:"Are you sure to delete these files?",onConfirm:async()=>{if(console.log(B),B.length>0){const e=JSON.parse(localStorage.getItem(h));for(let t=0;t<B.length;t++){J.push(f.deletekey(B[t].filekey));let n=e.findIndex((e=>B[t].filekey===e.filekey));if(-1===n)return s.ZP.error("Please select the file to delete!"),0;e.splice(n,1)}console.log(e);const n=JSON.stringify(e);""!==h&&localStorage.setItem(h,n),z=!1,t({}),s.ZP.success("Deleted successded")}else s.ZP.error("Please select the file to delete!")},onCancel:()=>{s.ZP.error("Cancel deletion")},okText:"Yes",cancelText:"No"},l.createElement(u.Z,{type:"primary"},"Delete"))))))}}}]);