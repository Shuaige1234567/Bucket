"use strict";(self.webpackChunkContainer_assets=self.webpackChunkContainer_assets||[]).push([[236,89],{9465:(e,t,n)=>{n.d(t,{Z:()=>i});var l=n(8081),o=n.n(l),a=n(3645),s=n.n(a)()(o());s.push([e.id,".title .drop {\n  cursor: pointer;\n  width: 520px;\n  border-radius: 2px;\n  border-color: #eeeeee;\n  border-style: dashed;\n  color: #bdbdbd;\n  outline: none;\n  margin: auto;\n}\n.title .uploadBac {\n  position: relative;\n  padding-top: 20px;\n  padding-bottom: 20px;\n  background-color: #fafafc;\n}\n.title .uploadBac p {\n  text-align: center;\n  font-size: 20px;\n  margin-bottom: 0px !important;\n}\n\n.uploadBac .icon svg {\n  width: 35px;\n  height: 35px;\n}\n.fileTable .ant-table-tbody > tr > td {\n  max-width: 300px;\n}\n.showTable {\n  width: 100%;\n  position: relative;\n}\n.showTable .ant-spin-container {\n  transition: all 2s ease;\n}\n.action_bac {\n  width: 100%;\n  height: 32px;\n  bottom: 15px;\n  position: absolute;\n}\n.showTable .ant-pagination-prev,\n.showTable .ant-pagination-next,\n.showTable .ant-pagination-item {\n  z-index: 1;\n}\n.Action {\n  position: absolute;\n  right: 200px;\n}\n",""]);const i=s},8089:(e,t,n)=>{n.r(t),n.d(t,{default:()=>J,getReverseFileExtension:()=>C});var l=n(7294),o=n(463),a=n(2023),s=n(7183),i=n(8361),r=n(331),c=n(4078),g=n(1577),u=n(1813),p=n(2484),d=n(5689),m=n(9704),f=n(3379),h=n.n(f),k=n(7795),y=n.n(k),b=n(569),w=n.n(b),v=n(3565),x=n.n(v),E=n(9216),_=n.n(E),Z=n(4589),I=n.n(Z),N=n(9465),S={};S.styleTagTransform=I(),S.setAttributes=x(),S.insert=w().bind(null,"head"),S.domAPI=y(),S.insertStyleElement=_();h()(N.Z,S);N.Z&&N.Z.locals&&N.Z.locals;const{Content:A}=s.Z,C=e=>{switch(Object.keys(e)[0]){case"jpeg":return"image/jpeg";case"gif":return"image/gif";case"jpg":return"image/jpg";case"png":return"image/png";case"svg":return"image/svg";case"avi":return"video/avi";case"mp4":return"video/mp4";case"aac":return"video/aac";case"wav":return"audio/wav";case"mp3":return"audio/mp3";case"wasm":return"application/wasm";default:return""}},T=e=>{switch(e){case"image/jpeg":return{jpeg:null};case"image/gif":return{gif:null};case"image/jpg":return{jpg:null};case"image/png":return{png:null};case"image/svg":return{svg:null};case"video/avi":return{avi:null};case"video/aac":return{aac:null};case"video/mp4":return{mp4:null};case"audio/wav":return{wav:null};case"audio/mp3":case"audio/mpeg":return{mp3:null};case"application/wasm":return{wasm:null};default:return null}};let j="",P=[],R="",F=!1,O=0,B=!0,U=[];const z=[];const J=function(){const[e,t]=(0,l.useState)(""),{principal:n,assets:s,bucketActor:f}=(0,m.v9)((e=>e)),h=n.value;let k=JSON.parse(localStorage.getItem(h));const y=null===k?[]:k,b=null===s?[]:s.ok;if(y.length<b.length&&B)for(let e=0;e<b.length;e++)y[e]={filekey:b[e].file_key,bucketId:b[e].bucket_id.toString(),filename:b[e].file_name,filetype:[Object.keys(b[e].file_extension)[0]],id:b[e].file_key};function w(e){let t=0;return e.forEach((n=>{n.then((n=>{t++,console.log(n),t===Math.floor(e.length/2)&&location.reload()}))})),Promise.all(e)}const v=(0,l.useCallback)((e=>{let n=[];O=e.length,console.log(e);let l=0;for(let o=0;o<e.length;o++){const s=e[o];let r="";const c=[],g=[],u=[];let p=s.size;l+=p,console.log("fileSize:",p);let d=1992295,m=Math.ceil(p/d);console.log("chunks:",m);let h=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,k=0;const b=[],v=new FileReader;let x=T(s.type);v.onload=function(e){console.log("333");let l=e.target.result,o=new Uint8Array(l),p=[];for(let e=0;e<o.length;e++)p.push(o[e]);let d=a.sha256.digest(p);if(u.push(d),g.push(p),c.push(...d),k++,k<m)E();else{if(r=(0,a.sha256)(c),r=r.toUpperCase(),y.find((e=>e.filekey===r)))O--,i.ZP.error(`${r} is Repeat`);else{F=!0,t({}),console.log("ok");for(let e=0;e<g.length;e++)console.log(r),b.push(f.put({file_key:r,file_name:s.name,file_extension:x,chunk:{digest:u[e],data:g[e]},chunk_number:m,order:e}));n.push(...b),0===n.length&&w(n).then((e=>{console.log(e)}))}}};const E=()=>{console.log("222222");let e=k*d,t=e+d>p?p:e+d;v.readAsArrayBuffer(h.call(s,e,t))};E()}}),[y,f]);if(F){let e=JSON.parse(localStorage.getItem(h));setInterval((x=(null===e?[]:e).length,async()=>{console.log("in---------",O);let e=await f.getAssetExts();console.log(e.ok.length,x),e.ok.length===x+O&&(console.log("上传完成"),console.log(e.ok),location.reload(!0))}),1e3)}var x;(0,l.useEffect)((()=>()=>{Promise.all(z).then((()=>{console.log("deleted")}))}));const E=e=>async()=>{(async e=>{console.log(e);let t=await f.getAssetExtkey(e);console.log("RE",t);let n=Number(t.ok.need_query_times);console.log(n);let l=[];for(let t=0;t<n;t++){let n=await f.get({file_key:e,flag:t});console.log(t),console.log(n);let o=n.ok[0];for(let e=1;e<n.ok.length;e++)o=o.concat(n.ok[e]);l=l.concat(o)}console.log(l);let o=new Uint8Array(l).buffer;console.log(o);let a=C(t.ok.file_extension);const s=new Blob([o],{type:a});return console.log(s),URL.createObjectURL(s)})(e).then((e=>{e&&window.open(`${e}`)}))},_={onChange:(e,t)=>{U=t}},Z=[{title:"FileName",dataIndex:"filename"},{title:"BucketId",dataIndex:"bucketId"},{title:"FileKey",dataIndex:"filekey"},{title:"FileType",dataIndex:"filetype",render:e=>l.createElement("span",null,e.map((e=>{let t;switch(e){case"mp3":case"wav":t="volcano";break;case"acc":case"mp4":case"avi":t="geekblue";break;default:t="magenta"}return l.createElement(r.Z,{color:t,key:Date.now()},e)})))},{title:"Action",key:"action",render:(e,t)=>l.createElement(c.Z,{size:"middle"},l.createElement(g.Z,{type:"primary",onClick:E(t.filekey)},"Entry"))}],I=[];""!==j&&I.push({id:j,filename:"",bucketId:"",filekey:j,filetype:[""]}),j="",P=y.length>0?[...y,...I]:I,R=JSON.stringify(P),P.length>0&&""!==h&&localStorage.setItem(h,R);const{getRootProps:N,getInputProps:S}=(0,o.uI)({onDrop:v});return l.createElement(A,{style:{padding:"0 0",minHeight:0},className:"main"},l.createElement("div",{className:"showTable"},l.createElement("div",{className:"title"},l.createElement("div",null,l.createElement("div",{className:"drop",...N()},l.createElement("input",{...S()}),l.createElement("div",{className:"uploadBac"},l.createElement("p",null,l.createElement(d.Z,{className:"icon"})),l.createElement("p",null,"Click one or drag many files to this area to upload"))))),l.createElement(u.Z,{className:"fileTable",rowSelection:_,rowKey:e=>e.id,columns:Z,pagination:{position:"bottomRight"},dataSource:P}),l.createElement("div",{className:"action_bac"},l.createElement(c.Z,{style:{display:P.length>0?"inline-flex":"none"},size:"middle",className:"Action"},l.createElement(p.Z,{title:"Are you sure to delete these files?",onConfirm:async()=>{if(console.log(U),U.length>0){const e=JSON.parse(localStorage.getItem(h));for(let t=0;t<U.length;t++){z.push(f.deletekey(U[t].filekey));let n=e.findIndex((e=>U[t].filekey===e.filekey));if(-1===n)return i.ZP.error("Please select the file to delete!"),0;e.splice(n,1)}console.log(e);const n=JSON.stringify(e);""!==h&&localStorage.setItem(h,n),B=!1,t({}),i.ZP.success("Deleted successded")}else i.ZP.error("Please select the file to delete!")},onCancel:()=>{i.ZP.error("Cancel deletion")},okText:"Yes",cancelText:"No"},l.createElement(g.Z,{type:"primary"},"Delete"))))))}},7236:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});var l=n(7294),o=n(9704),a=n(1817),s=n(8089);const i=function(e){const{bucketActor:t}=(0,o.v9)((e=>e));let n=e.match.params.filekey;return console.log(n),(async()=>{let e=await t.getAssetExtkey(n);console.log("RE",e);let l=Number(e.ok.need_query_times);console.log(l);let o=[];for(let e=0;e<l;e++){let l=await t.get({file_key:n,flag:e});console.log(e),console.log(l);let a=l.ok[0];for(let e=1;e<l.ok.length;e++)a=a.concat(l.ok[e]);o=o.concat(a)}console.log(o);let a=new Uint8Array(o).buffer;console.log(a);let i=(0,s.getReverseFileExtension)(e.ok.file_extension);const r=new Blob([a],{type:i});return console.log(r),URL.createObjectURL(r)})().then((e=>{console.log("ok"),console.log(e),""!==e&&window.open(`${e}`),window.history.back()})),l.createElement(a.Z,null)}}}]);