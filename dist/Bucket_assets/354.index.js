"use strict";(self.webpackChunkContainer_assets=self.webpackChunkContainer_assets||[]).push([[354,92],{2664:(e,t,n)=>{n.d(t,{Z:()=>i});var l=n(8081),o=n.n(l),a=n(3645),s=n.n(a)()(o());s.push([e.id,".title .drop {\n  cursor: pointer;\n  width: 1000px;\n  border-radius: 2px;\n  border-color: #eeeeee;\n  border-style: dashed;\n  color: #bdbdbd;\n  outline: none;\n  margin: auto;\n}\n.title .uploadBac {\n  position: relative;\n  padding-top: 20px;\n  padding-bottom: 20px;\n  background-color: #fafafc;\n}\n.title .uploadBac p {\n  text-align: center;\n  font-size: 20px;\n  margin-bottom: 0px !important;\n}\n\n.uploadBac .icon svg {\n  width: 35px;\n  height: 35px;\n}\n.fileTable .ant-table-tbody > tr > td {\n  max-width: 300px;\n}\n.showTable {\n  width: 100%;\n  position: relative;\n}\n.showTable .ant-spin-container {\n  transition: all 2s ease;\n}\n.action_bac {\n  width: 100%;\n  height: 32px;\n  bottom: 15px;\n  position: absolute;\n}\n.showTable .ant-pagination-prev,\n.showTable .ant-pagination-next,\n.showTable .ant-pagination-item {\n  z-index: 1;\n}\n.Action {\n  position: absolute;\n  right: 200px;\n}\n",""]);const i=s},1092:(e,t,n)=>{n.r(t),n.d(t,{default:()=>D,getReverseFileExtension:()=>T});var l=n(7294),o=n(463),a=n(2023),s=n(7480),i=n(7183),r=n(8361),c=n(331),g=n(4078),u=n(1577),p=n(1382),d=n(7265),m=n(2484),f=n(5689),h=n(9704),k=n(3379),y=n.n(k),b=n(7795),w=n.n(b),v=n(569),x=n.n(v),E=n(3565),S=n.n(E),_=n(9216),Z=n.n(_),I=n(4589),N=n.n(I),A=n(2664),j={};j.styleTagTransform=N(),j.setAttributes=S(),j.insert=x().bind(null,"head"),j.domAPI=w(),j.insertStyleElement=Z();y()(A.Z,j);A.Z&&A.Z.locals&&A.Z.locals;const{Content:C}=i.Z,T=e=>{switch(Object.keys(e)[0]){case"jpeg":return"image/jpeg";case"gif":return"image/gif";case"jpg":return"image/jpg";case"png":return"image/png";case"svg":return"image/svg";case"avi":return"video/avi";case"mp4":return"video/mp4";case"aac":return"video/aac";case"wav":return"audio/wav";case"mp3":return"audio/mp3";case"wasm":return"application/wasm";default:return""}},O=e=>{switch(e){case"image/jpeg":return{jpeg:null};case"image/gif":return{gif:null};case"image/jpg":return{jpg:null};case"image/png":return{png:null};case"image/svg":return{svg:null};case"video/avi":return{avi:null};case"video/aac":return{aac:null};case"video/mp4":return{mp4:null};case"audio/wav":return{wav:null};case"audio/mp3":case"audio/mpeg":return{mp3:null};case"application/wasm":return{wasm:null};default:return null}};let P=[],R="",F=!1,z=0,B=!0,U=!0,J=[];const L=[];const D=function(){const[e,t]=(0,l.useState)(""),[n,i]=(0,l.useState)(!1),{principal:k,assets:y,bucketActor:b}=(0,h.v9)((e=>e)),w=k.value;let v=JSON.parse(localStorage.getItem(w));const x=null===v?[]:v,E=null===y?[]:y.ok;if(x.length<E.length&&B)for(let e=0;e<E.length;e++)x[e]={filekey:E[e].file_key,bucketId:E[e].bucket_id.toString(),filename:E[e].file_name,filetype:[Object.keys(E[e].file_extension)[0]],id:(0,s.x0)()};const S=(0,l.useCallback)((e=>{let t=[];z=e.length,console.log(e);let n=0;for(let l=0;l<e.length;l++){const o=e[l];let s="";const c=[],g=[],u=[];let p=o.size;n+=p,console.log("fileSize:",p);let d=1992295,m=Math.ceil(p/d);console.log("chunks:",m);let f=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,h=0;const k=[],y=new FileReader;let w=O(o.type);y.onload=function(e){let n=e.target.result,l=new Uint8Array(n),p=[];for(let e=0;e<l.length;e++)p.push(l[e]);let d=a.sha256.digest(p);if(u.push(d),g.push(p),c.push(...d),h++,h<m)v();else{if(s=(0,a.sha256)(c),s=s.toUpperCase(),x.find((e=>e.filekey===s)))z--,r.ZP.error(`${s} is Repeat`);else{F=!0,i(!0);for(let e=0;e<g.length;e++)console.log(s),k.push(b.put({file_key:s,file_name:o.name,file_extension:w,chunk:{digest:u[e],data:g[e]},chunk_number:m,order:e}));t.push(...k),0===t.length&&Promise.all(t).then()}}};const v=()=>{let e=h*d,t=e+d>p?p:e+d;y.readAsArrayBuffer(f.call(o,e,t))};v()}}),[x,b]);if(F&&U){let e=JSON.parse(localStorage.getItem(w));setInterval((_=(null===e?[]:e).length,async()=>{const e=[];let n=JSON.parse(localStorage.getItem(w));const l=null===n?[]:n;let o=await b.getAssetExts();if(console.log(o.ok,l.length),o.ok.length>l.length)for(let t=0;t<o.ok.length;t++)console.log(o.ok[t]),e.push({id:(0,s.x0)(),filename:o.ok[t].file_name,bucketId:o.ok[t].bucket_id.toString(),filekey:o.ok[t].file_key,filetype:[Object.keys(o.ok[t].file_extension)[0]]});let a=JSON.stringify(e);if(e.length>0&&""!==w&&(U=!1,localStorage.setItem(w,a),t({})),o.ok.length===_+z)return console.log("上传完成"),console.log(o.ok),location.reload(),0}),1e3)}var _;(0,l.useEffect)((()=>()=>{Promise.all(L).then((()=>{console.log("deleted")}))}));const Z=e=>async()=>{i(!0),(async e=>{console.log(e);let t=await b.getAssetExtkey(e);console.log("RE",t);let n=Number(t.ok.need_query_times);console.log(n);let l=[];for(let t=0;t<n;t++){let n=await b.get({file_key:e,flag:t});console.log(n);let o=n.ok[0];for(let e=1;e<n.ok.length;e++)o=o.concat(n.ok[e]);l=l.concat(o)}console.log(l);let o=new Uint8Array(l).buffer;console.log(o);let a=T(t.ok.file_extension);const s=new Blob([o],{type:a});return console.log(s),URL.createObjectURL(s)})(e).then((e=>{e&&(i(!1),window.open(`${e}`))}))},I={onChange:(e,t)=>{console.log(t),J=t}},N=[{title:"FileName",dataIndex:"filename"},{title:"BucketId",dataIndex:"bucketId"},{title:"FileKey",dataIndex:"filekey"},{title:"FileType",dataIndex:"filetype",render:e=>l.createElement("span",null,e.map((e=>{let t;switch(e){case"mp3":case"wav":t="volcano";break;case"acc":case"mp4":case"avi":t="geekblue";break;default:t="magenta"}return l.createElement(c.Z,{color:t,key:(0,s.x0)()},e)})))},{title:"Action",key:"action",render:(e,t)=>l.createElement(g.Z,{size:"middle"},l.createElement(u.Z,{type:"primary",onClick:Z(t.filekey)},"Entry"))}];P=[...x],R=JSON.stringify(P),P.length>0&&""!==w&&localStorage.setItem(w,R);const{getRootProps:A,getInputProps:j}=(0,o.uI)({onDrop:S});return l.createElement(p.Z,{spinning:n,size:"large"},l.createElement(C,{style:{padding:"0 0",minHeight:0},className:"main"},l.createElement("div",{className:"showTable"},l.createElement("div",{className:"title"},l.createElement("div",null,l.createElement("div",{className:"drop",...A()},l.createElement("input",{...j()}),l.createElement("div",{className:"uploadBac"},l.createElement("p",null,l.createElement(f.Z,{className:"icon"})),l.createElement("p",null,"Click one or drag many files to this area to upload"))))),l.createElement(d.Z,{className:"fileTable",rowSelection:I,rowKey:e=>e.id,columns:N,pagination:{position:"bottomRight"},dataSource:P}),l.createElement("div",{className:"action_bac"},l.createElement(g.Z,{style:{display:P.length>0?"inline-flex":"none"},size:"middle",className:"Action"},l.createElement(m.Z,{title:"Are you sure to delete these files?",onConfirm:async()=>{if(console.log(J),J.length>0){const e=JSON.parse(localStorage.getItem(w));for(let t=0;t<J.length;t++){L.push(b.deletekey(J[t].filekey));let n=e.findIndex((e=>J[t].filekey===e.filekey));if(-1===n)return r.ZP.error("Please select the file to delete!"),0;e.splice(n,1)}console.log(e);const n=JSON.stringify(e);""!==w&&localStorage.setItem(w,n),B=!1,J=[],t({}),r.ZP.success("Deleted successded")}else r.ZP.error("Please select the file to delete!")},onCancel:()=>{r.ZP.error("Cancel deletion")},okText:"Yes",cancelText:"No"},l.createElement(u.Z,{type:"primary"},"Delete")))))))}},5354:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});var l=n(7294),o=n(9704),a=n(3225),s=n(1092);const i=function(e){const{bucketActor:t}=(0,o.v9)((e=>e));let n=e.match.params.filekey;return console.log(n),(async()=>{let e=await t.getAssetExtkey(n);console.log("RE",e);let l=Number(e.ok.need_query_times);console.log(l);let o=[];for(let e=0;e<l;e++){let l=await t.get({file_key:n,flag:e});console.log(e),console.log(l);let a=l.ok[0];for(let e=1;e<l.ok.length;e++)a=a.concat(l.ok[e]);o=o.concat(a)}console.log(o);let a=new Uint8Array(o).buffer;console.log(a);let i=(0,s.getReverseFileExtension)(e.ok.file_extension);const r=new Blob([a],{type:i});return console.log(r),URL.createObjectURL(r)})().then((e=>{console.log("ok"),console.log(e),""!==e&&window.open(`${e}`),window.history.back()})),l.createElement(a.Z,null)}}}]);